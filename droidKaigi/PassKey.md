# パスキーの導入事例と UX 上の課題

## 概要

- パスワード認証は脆弱と言われる
  - 複雑なパスワード考えるのめんどいから使いまわされる
  - フィッシングにも引っ掛かり、芋づる式に情報を抜かれる
  - パスキーならこういうことが起こらない
- ただ、実際に脆弱なのは人間のパスワード運用である
  - システムにやらせることで解決済み?
    - パスワードマネージャー
      - パスワードをサービスごとに自動生成してくれる
      - フィッシングにも強い
    - ただ、パスワードマネージャーの使用をユーザーに強制することが出来ない

## FIDO,FIDO2,PassKey

- FIDO
  - 公開鍵暗号化
  - 端末のロック解除を利用する(ローカル認証)
    - 端末ロック解除をユーザー認証に使うだけで、ロック解除に必要な情報が各サービスにいきわたることはない。
- FIDO2
  - ブラウザが中継に入ることでフィッシング耐性がつく
    - アクセスしている URL が本物かどうかを確認してくれるので、ニセページに認証情報を入力してしまうことを防げる
- Passkey
  - 結構定義がバラバラ
  - FIDO 認証を使用するのに必要なクレデンシャルのこと
    - 端末個別の安全な領域に秘密鍵を保存する？
  - 各社導入を進めている
    - Google はパスワードマネージャー
    - プラットフォームごとに個別になっている
  - 複数のデバイスでパスキーを利用できるように、最近では「外部 Passkey」が注目されている
    - アカウントのプラットフォームによらず一元的に管理できる
    - 外部 Passkey を使用するか、プラットフォームが提供する Passkey を使用するかは選択可能

## UseCases

- Yahoo
  - メアドなどのユーザー識別式を先に入力
  - パスキー登録あればパスキーログイン画面を表示する
    - パスキーが使用できない場合に別のログイン経路へ誘導するのが結構めんどい
    - パスキーが使えるかどうかを推測する仕組みがある
- GitHub
  - 通常サインインとパスキーサインインを選べる
  - パスキーを選択するとユーザー名とキーが表示される
    - Yahoo と異なり、事前にユーザーを特定しない
    - パスキー登録の有無によるバリデーションが存在しない
    - 開発者向けサイトならでは。
- Mixi
  - パスワード入力欄のオートフィルにパスキーを表示
    - 現在の端末で登録されているパスキーがなければ「別端末のパスキーを読み込む」も表示
    - ついでに利用可能なパスワードも表示
    - 既存のパスワードマネージャーの UI を拡張するようにした
      - これまでのパスワードマネージャー利用者にとっては使いやすい
  - PC ログイン時にモバイルで登録したパスキーを利用できる
    - 画面に QR が出るのでそれを読みこむ
    - Bluetooth 接続し、近くの端末のパスキーを利用できる
    - ただユーザーにとって便利な認証とはいいがたいので、PC でのパスキー登録に誘導する流れが主流
  - 悪意あるユーザによるなりすまし防止
    - アカウント設定など重要度の高い操作を行う際に再認証を要求する仕組みを検討している
    - GitHub みたい

## Passkey 導入に必要な機能

- 会員登録
  - パスキーを登録してもらう
- 既存ユーザーのログイン
  - パスキーを登録してもらう
  - パスキーを管理する
  - パスキーが使えなくなった時のリカバリ

## Native アプリに導入するには？

- Android 公式がヒントを公開しているよ
  - 「パスキー使いますか？」ポップアップが出てくるようにする
  - アンチパターンも乗っかってるので UI の実装はしやすそう
  - パスキーが使えないときにはメール認証でリカバリーしよう

## Web アプリでも提供する場合

- Web ブラウザでパスキー認証をリクエストする
- ブラウザの用途などに左右される

## UX 上の課題

- パスワードマネージャでパスワードを生成するときに比べて、パスキーの生成時には確認事項が非常に多い
- もっとシームレスで使いやすい登録手順を生み出す必要があるね
- 「パスキーでログインして！」→「パスキーがありません」エラー
  - ユーザー「は？」
  - エラーを出すのではなく、サービス側に戻して別経路に誘導すべき
- パスキー相当のガード性能を担保しつつリカバリするには？
  - 問い合わせを受け、本人確認の後パスキーをリセット
  - 複数のパスキーを所有している状態でリセットをかけると、パスキー間で認証情報の不整合が発生することがある。
- Google や X など、ログイン情報を提供する側が不正アクセスを受け、そのアカウントを使用している他のサービスにも不正ログインのリスクが生じているときにも、パスキーは有効
